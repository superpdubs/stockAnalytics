{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block header %}{% include 'header.html' %}
{% endblock %}

{% block body_contents %}
    <div class="content">
      <h1>Register</h1>
{% if info != None %}
      <span class="info">{{ info }}</span>
{% endif %}
      <form method="POST" action="{{ url_for('register') }}" >
        <div>
          <label for="firstname">First name</label>
          <input id="firstname" name="firstname" type="text">
        </div>
        <span class="fname_status status"></span>
        <div>
          <label for="lastname">Last name</label>
          <input id="lastname" name="lastname" type="text">
        </div>
        <span class="lname_status status"></span>
        <div>
          <label for="email">Email Address</label>
          <input autocomplete="username" id="email" name="email" type="email">
        </div>
        <span class="email_status status"></span>
        <div>
          <label for="user_pass">Password</label>
          <input id="user_pass" name="user_pass" type="password">
        </div>
        <span class="pass_status status"></span>
        <div>
          <label for="confirm">Confirm Password</label>
          <input id="confirm" name="confirm" type="password">
        </div>
        <span class="confirm_status status"></span>
        <div>
          <a href="{{ url_for('login') }}" class="button">Login</a>
          <button type="submit">Register</button>
        </div>
      </form>
    </div>

    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery-3.3.1.min.js') }}"></script>
  <script>
      var emailchecked = false;
      var fnamechecked = false;
      var lnamechecked = false;
      var passchecked = false;
      var cpasschecked = false;

      $("#email").blur(function(){
       email= document.getElementById("email").value;  
        if(Object.keys(email).length > 0) {
            $.ajax({
                type: 'get',
                url: '{{ url_for('check_email') }}',
                data: {this_email: email},
                dataType: 'json',
                success: function (data) {
                    if (data.eval == 1) {
                        $('.email_status').html(data.msg);
                        $("#btn_code").attr('disabled',false);
                        emailchecked = true;
                    } else {
                        $('.email_status').html(data.msg);
                        emailchecked = false;
                        $("#btn_code").attr('disabled',true);
                    }
                }
            });
        }else{
            $('.email_status').html("");
        }
      }) 

      $("#firstname").blur(function(){
       var firstname= document.getElementById("firstname").value;
       if(Object.keys(firstname).length > 0){
           $('.fname_status').html("Passed!");
           fnamechecked = true;
       }else{
            $('.fname_status').html("");
            fnamechecked = false;
       } }) 

      $("#lastname").blur(function(){
       var lastname= document.getElementById("lastname").value;
       if(Object.keys(lastname).length > 0){
           $('.lname_status').html("Passed!");
           lnamechecked = true;
       }else{
            $('.lname_status').html("");
            lnamechecked = false;
       } }) 

      $("#user_pass").blur(function(){
       var password= document.getElementById("user_pass").value;
       if(Object.keys(password).length > 0){
           if( 6<= Object.keys(password).length){
               if(Object.keys(password).length>11){
                   $('.pass_status').html("Length of password should be 6-11 characters");
                   passchecked = false;
               }else{
                   $('.pass_status').html("This password could be used");
                    passchecked = true;
               }
           }else{
               $('.pass_status').html("Length of password should be 6-11 characters");
                passchecked = false;
           }
       }else{
            $('.pass_status').html("");
             passchecked = false;
       } }) 

      $("#confirm").blur(function(){
       var cpassword= document.getElementById("confirm").value;
       var password= document.getElementById("user_pass").value;
       if(Object.keys(cpassword).length>0){
           if(cpassword==password){
                $('.confirm_status').html("");
                cpasschecked = true;
           }else{
                $('.confirm_status').html("This doesn't match your original password");
                cpasschecked = false;
           }
       }else{
            $('.confirm_status').html(" ");
            cpasschecked = false;
        }
      })
    </script>{% endblock %}
