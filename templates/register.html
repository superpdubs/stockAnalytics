{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block header %}{% include 'header.html' %}
{% endblock %}

{% block body_contents %}
    <div class="content">
      <h1>Register</h1>
      <form name="myRegistrationForm" method="POST" action="" >
{% if info != None %}
        <span class="info">{{ info }}</span>
{% endif %}
        <div>
          {{ thisform.firstname.label }}
          {{ thisform.firstname }}
          <span class='fname_status'></span>
        </div>
        <div>
          {{ thisform.lastname.label }}
          {{ thisform.lastname }}
          <span class='lname_status'></span>
        </div>
        <div>
          {{ thisform.user_pass.label }}
          {{ thisform.user_pass }}
          <span class='pass_status'></span>
        </div>
        <div>
          {{ thisform.confirm.label }}
          {{ thisform.confirm }}
          <span class='confirm_status'></span>
        </div>
        <div>
          {{ thisform.email.label }}
          {{ thisform.email }}
          <span class='email_status'></span>
        </div>
        <button type="submit">Register</button>
        <a href="url_for('login')" class="button">Login</a>
      </form>
    </div>

    <script type="text/javascript" src="{{url_for('static', filename='js/jquery-3.3.1.min.js')}}"></script>
  <script>
      var emailchecked = false;
      var fnamechecked = false;
      var lnamechecked = false;
      var passchecked = false;
      var cpasschecked = false;

      $("#email").blur(function(){
       email= document.getElementById("email").value;  
        if(Object.keys(email).length > 0) {
            $.ajax({
                type: 'get',
                url: '{{ url_for('check_email') }}',
                data: {this_email: email},
                dataType: 'json',
                success: function (data) {
                    if (data.eval == 1) {
                        $('.email_status').html(data.msg);
                        $("#btn_code").attr('disabled',false);
                        emailchecked = true;
                    } else {
                        $('.email_status').html(data.msg);
                        emailchecked = false;
                        $("#btn_code").attr('disabled',true);
                    }
                }
            });
        }else{
            $('.email_status').html("");
        }
      }) 

      $("#firstname").blur(function(){
       var firstname= document.getElementById("firstname").value;
       if(Object.keys(firstname).length > 0){
           $('.fname_status').html("Passed!");
           fnamechecked = true;
       }else{
            $('.fname_status').html("");
            fnamechecked = false;
       } }) 

      $("#lastname").blur(function(){
       var lastname= document.getElementById("lastname").value;
       if(Object.keys(lastname).length > 0){
           $('.lname_status').html("Passed!");
           lnamechecked = true;
       }else{
            $('.lname_status').html("");
            lnamechecked = false;
       } }) 

      $("#user_pass").blur(function(){
       var password= document.getElementById("user_pass").value;
       if(Object.keys(password).length > 0){
           if( 6<= Object.keys(password).length){
               if(Object.keys(password).length>11){
                   $('.pass_status').html("Length of password should be 6-11 characters");
                   passchecked = false;
               }else{
                   $('.pass_status').html("This password could be used");
                    passchecked = true;
               }
           }else{
               $('.pass_status').html("Length of password should be 6-11 characters");
                passchecked = false;
           }
       }else{
            $('.pass_status').html("");
             passchecked = false;
       } }) 

      $("#confirm").blur(function(){
       var cpassword= document.getElementById("confirm").value;
       var password= document.getElementById("user_pass").value;
       if(Object.keys(cpassword).length>0){
           if(cpassword==password){
                $('.confirm_status').html("");
                cpasschecked = true;
           }else{
                $('.confirm_status').html("This doesn't match your original password");
                cpasschecked = false;
           }
       }else{
            $('.confirm_status').html(" ");
            cpasschecked = false;
        }
      })
    </script>{% endblock %}
